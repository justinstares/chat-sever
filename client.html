<!DOCTYPE html>
<html>
   <head>
     <meta charset="utf-8" />
     <meta http-equiv="X-UA-Compatible" content="IE=edge">
     <title>Chatroom</title>
     <meta name="viewport" content="width=device-width, initial-scale=1">
     <link rel="stylesheet" type="text/css" href="style.css"/>
     <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
     <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.css">
     <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>

     <script src="/socket.io/socket.io.js"></script>
     <script type ="text/javascript">

      var socketio = io.connect();
      var user;
      var currentrm;

      socketio.on("message_to_client",function(data) {
         //Append an HR thematic break and the escaped HTML of the new message
         document.getElementById("chatlog").innerHTML += "<hr>" + data['username'] + ": " + data['message'];
      });
      socketio.on("room_left_message",function(data) {
         //Append an HR thematic break and the escaped HTML of the new message
         document.getElementById("chatlog").innerHTML += "<hr>" + data['username'] + " has left the room.";
         $("#chatlog").addClass("off");
         $("#usersChat").addClass("off");



      });
      socketio.on("room_left_message2",function(data) {
         //Append an HR thematic break and the escaped HTML of the new message
         document.getElementById("current_room").innerHTML += "You hav left the room and are not in any chatrooms.";
      });
      socketio.on("login_info",function(data) {
         //Append an HR thematic break and the escaped HTML of the new message
         document.getElementById("welcome_message").innerHTML = "Welcome to the Main Paige: " + user;
         //document.getElementById("users_list").innerHTML = "Welcome2: " + data['usersArray'];

         document.getElementById("users_list").innerHTML = "<strong>" + "Active Users:" + "</strong>" + "<br>";
        for(var i = 0; i<data['usersArray'].length; i++){
          document.getElementById("users_list").innerHTML += data['usersArray'][i] + "<br>";
         }
        document.getElementById("chat_list").innerHTML = "<strong>" + "List of Chatrooms:" + "</strong>" + "<br>";
        for(var j = 0; j<data['roomsArray'].length; j++){
        document.getElementById("chat_list").innerHTML += data['roomsArray'][j] + "<br>";
         }

      });
      socketio.on("logout_info",function(data) {
         //do something
      });
      socketio.on("newroom_info",function(data) {
         //Append an HR thematic break and the escaped HTML of the new message
         document.getElementById("chat_list").innerHTML = "<strong>" + "List of Chatrooms:" + "</strong>" + "<br>";
         for(var k = 0; k<data['roomsArray'].length; k++){
         document.getElementById("chat_list").innerHTML += (data['roomsArray'][k]) + "<br>";
        }
      });
      socketio.on("room_info",function(data) {
         document.getElementById("chat_list").appendChild(document.createTextNode(data['room']));
      });
      socketio.on("room_joined",function(data) {
         //Append an HR thematic break and the escaped HTML of the new message
         $("#leave_room").removeClass("off");
         document.getElementById("current_room").innerHTML = "You have joined the room: " + data['room'];
         document.getElementById("usersChat").innerHTML = "<strong>" + "List of Users in the Chatroom:" + "</strong>";
         for(var l = 0; l<data['usersInRoomArray'].length; l++){
         document.getElementById("usersChat").innerHTML += (data['usersInRoomArray'][l]) + "<br>";
          }
      });
      socketio.on("room_dne",function(data) {
         //Append an HR thematic break and the escaped HTML of the new message
         alert("The room you entered does not exist: " + data["room"]);
      });

      function sendMessage(){
        if(currentrm == null){
          alert("You have to join a chatroom to send messages!")
          return;
        }
         var msg = document.getElementById("message_input").value;
         socketio.emit("message_to_server", {message:msg, username:user, currentroom:currentrm});
      }
      function newRoom(){
         var nr = document.getElementById("newRoom_input").value;
         socketio.emit("room_create", {newroom:nr, username:user});
      }
      function privateRoom(){
         var a = document.getElementById("newRoom_input").value;
         socketio.emit("privateroom_create", {newroom:nr, username:user});
      }
      function joinRoom(){
         currentrm = document.getElementById("joinRoom_input").value;
         socketio.emit("room_access", {room:currentrm, username:user});
      }
      function leaveRoom(){

         $("#leave_room").addClass("off");
         socketio.emit("room_leave", {currentroom:currentrm, username:user});

      }
      function login(){
         user = document.getElementById("username_input").value;
         //have to check if user already exits at some point as well
         if(user == ""){
           alert("username is null");
         }
         else{
           socketio.emit("login_success", {username:user});
           $("#welcome_message").removeClass("off");
           $("#current_room").removeClass("off");
           $("#users_list").removeClass("off");
           $("#action_bar").removeClass("off");
           $("#chat_list").removeClass("off");
           $("#login_bar").addClass("off");
           $("#logout_bar").removeClass("off");
           $("#goodbye_message").addClass("off");
           $("#nav").removeClass("off");
           $("#chatlog").removeClass("off");
           $("#usersChat").removeClass("off");




         }
      }
      function logout(){
        socketio.emit("logout_success", {username:user});
        $("#users_list").addClass("off");
        $("#welcome_message").addClass("off");
        $("#chat_list").addClass("off");
        $("#action_bar").addClass("off");
        $("#login_bar").removeClass("off");
        $("#logout_bar").addClass("off");
        $("#goodbye_message").removeClass("off");
        $("#current_room").addClass("off");
        $("#nav").addClass("off");
        $("#chatlog").addClass("off");
        $("#usersChat").addClass("off");



      }

      </script>

   </head>
   <body>

    <div id="nav" class="sidenav off">
      <div id="logout_bar" class="off">
       <button class="buttonGreen" onclick="logout()">Logout</button>
      </div>
      <div id="action_bar" class="off">
       <label for="newRoom_input"><b>Create New Room:</b></label>
       <input type="text" id="newRoom_input"/>
       <button onclick="newRoom()">Create Public</button>
       <button onclick="privateRoom()">Create Private</button>

       <br>

       <label for="joinRoom_input"><b>Join Chatroom:</b></label>
       <input type="text" id="joinRoom_input"/>
       <button onclick="joinRoom()">Join</button>
       <br>

       <label for="message_input"><b>Send Message:</b></label>
       <input type="text" id="message_input"/>
       <button onclick="sendMessage()">Send</button>
       <br>
      </div>

      <div id="users_list" class="off">
         <label><strong>Users:</strong></label>
      </div>
       <br>
      <div id="chat_list" class="off">
         <label><strong>List of Chatrooms:</strong></label><br>
      </div>
       <br>

    </div>

    <!-- Page content -->
    <div id="main">
      <div id="login_bar" class="">
       <label for="username_input"><b>Login:</b></label>
       <input type="text" id="username_input"/>
       <button class="buttonBlue" onclick="login()">Login</button>
      </div>

      <div id="welcome">
      <label id="welcome_message" class="off">Welcome</label>
      </div>
      <div id="current_room" class="off">
          <label><strong>You are not part of a chatroom!</strong></label><br>
      </div>
      <label id="goodbye_message" class="off">You have logged out!</label>
      <!-- <div id="sendMessage" class="off">
      <label for="message_input"><b>Send Message:</b></label>
      <input type="text" id="message_input"/>
      <button onclick="sendMessage()">Send</button>
    </div>
    <br> -->
    <div id="leave_room" class="off">
     <button class="buttonBlue" onclick="leaveRoom()">Leave Room</button>
    </div>
      <div id="chatlog" class="off"></div>
      <div id="usersChat" class="off"></div>
    </div>








   </body>
</html>
